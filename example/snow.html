<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>snow</title>
    <link rel="stylesheet" href="css/normalize.css">
    <style type="text/css">
    canvas { position: absolute; top: 0; left: 0; background-color: #0086B3;}
    </style>
</head>
<body>
<h1>h1</h1>
<h2>h2</h2>
<h3>h3</h3>
<button>button</button>
<canvas id="Js_canvas"></canvas>
<script src="js/Kanvas.js"></script>
<script>
(function(){
    var K = Kanvas,
        width = window.innerWidth,
        height = window.innerHeight,
        canvas = K.getCanvas("#Js_canvas", {
            width: width,
            height: height
        }),
        ctx = canvas.getContext("2d");

    var snowflakeUrl = "img/Snowflakes.png";
    var snowflakeCollect = [];

    // particle movement parameters:
    // we'll advance each particle vertically at least by this amount (think gravity and resistance)
    var minVerticalVelocity = 1;
    // we'll advance each particle vertically at most by this amount (think gravity and resistance)
    var maxVerticalVelocity = 4;
    // we'll shift each particle horizontally at least by this amound (think wind and resistance)
    var minHorizontalVelocity = -1;
    // we'll shift each particle horizontally at least by this amound (think wind and resistance)
    var maxHorizontalVelocity = 3;
    // each particle sprite will be scaled down maxScale / this (this < maxScale) at max
    var minScale = 0.2;
    // each particle sprite will be scaled down this / minScale (this > minScale) at max
    var maxScale = 1.25;
    // each particle also "bobs" on horizontal axis (think volumetric resistance) by this amount at least
    var minHorizontalDelta = 2;
    // each particle also "bobs" on horizontal axis (think volumetric resistance) by this amount at most
    var maxHorizontalDelta = 3;
    // each particle is at least this opaque
    var minOpacity = 0.2;
    // each particle is at least this opaque
    var maxOpacity = 0.9;
    // change opacity by at max 1/maxOpacityIncrement
    var maxOpacityIncrement = 50;
    var speedFactor = 1;
    var spriteWidth = 20;
    var spriteHeight = 20;

    function generateSnowflake() {
        var scale = Math.random() * (maxScale - minScale) + minScale;
        return {
            type: Math.round(Math.random() * 4),
            x: Math.random() * width,
            y: Math.random() * height,
            sw: scale * spriteWidth,
            sh: scale * spriteHeight,
            velocityX: Math.random() * (maxHorizontalVelocity - minHorizontalVelocity) + minHorizontalVelocity,
            velocityY: Math.random() * (maxVerticalVelocity - minVerticalVelocity) + minVerticalVelocity,
            mhd: Math.random() * (maxHorizontalDelta - minHorizontalDelta) + minHorizontalDelta,
            hd: 0,
            hdi: Math.random() / (maxHorizontalVelocity * minHorizontalDelta),
            o: Math.random() * (maxOpacity - minOpacity) + minOpacity,
            oi: Math.random() / maxOpacityIncrement
        }
    }
    snowflakeCollect.push(generateSnowflake());

    function updateSnowflake(status){
        status.x = status.x + status.velocityX * speedFactor;
        status.y = status.y + (status.velocityY + status.hd) * speedFactor;
        status.hd += status.hdi;
        if (status.hd < -status.mhd || status.hd > status.mhd) {
            status.hdi = -status.hdi;
        };
    }

    function drawSnowflake() {
        var img = new Image();
        img.onload = function(){
            ctx.clearRect(0, 0, width, height);
            snowflakeCollect.forEach(function(obj, index, array){
                updateSnowflake(obj);
                if (obj.y > height + obj.scale || obj.x < -obj.scale || obj.x > width + obj.scale) {
                    array.splice(index, 1);
                } else {
                    ctx.drawImage(img, obj.type * 20, 0, 20, 20, obj.x, obj.y, obj.sw, obj.sh);
                }
            });
        };
        img.src = snowflakeUrl;
    }


    function frame(){
        drawSnowflake();
        if (snowflakeCollect.length < 100) {
            snowflakeCollect.push(generateSnowflake());
        }
        K.requestAnimationFrame.call(window, frame);
    }
    frame();
})();
</script>
</body>
</html>