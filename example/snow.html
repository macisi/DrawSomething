<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>snow</title>
    <link rel="stylesheet" href="css/normalize.css">
    <style type="text/css">
    canvas { position: absolute; top: 0; left: 0; background-color: #0086B3;}
    </style>
</head>
<body>
<h1>h1</h1>
<h2>h2</h2>
<h3>h3</h3>
<button>button</button>
<canvas id="Js_canvas"></canvas>
<script src="js/Kanvas.js"></script>
<script>
(function(){
    var K = Kanvas,
        width = window.innerWidth,
        height = window.innerHeight,
        canvas = K.getCanvas("#Js_canvas", {
            width: width,
            height: height
        }),
        ctx = canvas.getContext("2d");

    var snowflakeUrl = "img/Snowflakes.png";
    var snowflakeCollect = [];

    function generateSnowflake() {
        return {
            type: Math.round(Math.random() * 4),
            x: Math.round(width * Math.random()),
            y: 0,
            opacity: Math.random(),
            scale: Math.random() * 20,
            speedX: Math.round((Math.random() - .5) * 5),
            speedY: Math.ceil(Math.random() + 1)
        }
    }
    snowflakeCollect.push(generateSnowflake());

    function updateSnowflake(status){
        status.x = status.x + status.speedX;
        status.y = status.y + status.speedY;
    }

    function drawSnowflake() {
        var img = new Image();
        img.onload = function(){
            snowflakeCollect.forEach(function(obj, index, array){
                updateSnowflake(obj);
                if (obj.y > height + obj.scale || obj.x < -obj.scale || obj.x > width + obj.scale) {
                    array.splice(index, 1);
                } else {
                    ctx.drawImage(img, obj.type * 20, 0, 20, 20, obj.x, obj.y, obj.scale, obj.scale);
                }
            });
        };
        img.src = snowflakeUrl;
    }


    function frame(){
        ctx.clearRect(0, 0, width, height);
        drawSnowflake();
        if (snowflakeCollect.length < 100) {
            snowflakeCollect.push(generateSnowflake());
        }
        K.requestAnimationFrame.call(window, frame);
    }
    frame();
})();
</script>
</body>
</html>