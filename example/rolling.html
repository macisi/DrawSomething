<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>learn canvas</title>
    <link rel="stylesheet" href="css/normalize.css">
    <style>
        canvas { border: 1px solid #000;}
    </style>
</head>
<body>
<canvas id="Js_canvas"></canvas>
<script>
var canvas = document.getElementById("Js_canvas");
var ctx = canvas.getContext("2d");
var stageWidth = canvas.width = window.innerWidth - 30;
var stageHeight = canvas.height = window.innerHeight - 30;

var requestAnimFrame = (function(callback) {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
        window.setTimeout(callback, 1000 / 60);
    };
})();

var keypress = false;
document.addEventListener("keydown", function(e){
    if (!keypress) {
        keypress = true;
    }
    move(e.keyCode);
}, false);
document.addEventListener("keyup", function(e){
    keypress = false;
    ball.acceleration = {
        x: 0,
        y: 0
    }
}, false);
document.addEventListener("", function(e){
    console.log(e);
}, false);

function Ball(){
    this.radius = 5;
    this.fillStyle = "#000";
    this.x = this.radius;
    this.y = stageHeight - this.radius;
    this.acceleration = {
        x: 0,
        y: 0
    };
    this.velocity = {
        x: 0,
        y: 0
    }

    this.draw = function(){
        ctx.fillStyle = this.fillStyle;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
    }
}
var ball = new Ball();

function move(keyCode){
    switch (keyCode) {
        case 37:
//            console.log("left");
            ball.acceleration.x = -1;
            break;
        case 38:
//            console.log("top");
            ball.acceleration.y = -1;
            break;
        case 39:
//            console.log("right");
            ball.acceleration.x = 1;
            break;
        case 40:
//            console.log("bottom");
            ball.acceleration.y = 1;
            break;
    }
}

var date, time, timeDiff, lastTime;
function updateSence(){
    date = new Date();
    time = date.getTime();
    timeDiff = lastTime ? time - lastTime : 0;
    timeDiff = timeDiff / 100;
    lastTime = time;

    ball.velocity.x = ball.velocity.x + timeDiff * ball.acceleration.x;
    ball.velocity.y = ball.velocity.y + timeDiff * ball.acceleration.y;

    ball.x = ball.x + ball.velocity.x * timeDiff;
    ball.y = ball.y + ball.velocity.y * timeDiff;

    if (ball.x > stageWidth - ball.radius || ball.x < ball.radius) {
        ball.velocity.x = - ball.velocity.x;
    }
    if (ball.y > stageHeight - ball.radius || ball.y < ball.radius) {
        ball.velocity.y = - ball.velocity.y;
    }
    ball.x = ball.x > stageWidth - ball.radius ? stageWidth - ball.radius : ball.x;
    ball.x = ball.x < ball.radius ? ball.radius : ball.x;
    ball.y = ball.y > stageHeight - ball.radius ? stageHeight - ball.radius : ball.y;
    ball.y = ball.y < ball.radius ? ball.radius : ball.y;


    ctx.clearRect(0, 0, stageWidth, stageHeight);

    ball.draw();

    requestAnimFrame(updateSence);
}
updateSence();
</script>
</body>
</html>