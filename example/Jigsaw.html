<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>演示</title>
    <link rel="stylesheet" href="css/normalize.css">
    <style type="text/css">
        canvas { position: absolute; top: 0; left: 0;}
    </style>
</head>
<body>
<canvas id="Js_canvas"></canvas>
<script src="js/Kanvas.js"></script>
<script>
(function(){
    var K = Kanvas,
        width = window.innerWidth,
        height = window.innerHeight,
        canvas = K.getCanvas("#Js_canvas", {
            width: width,
            height: height
        }),
        ctx = canvas.getContext("2d"),
        stageCenter = {
            x: width / 2,
            y: height / 2
        };

    function Fragment() {
    }
    Fragment.prototype = {
        update: function(){
            var deltX = this.target[0] > this.current[0] ? Math.ceil((this.target[0] - this.current[0]) / 10) : Math.floor((this.target[0] - this.current[0]) / 10),
                deltY = this.target[1] > this.current[1] ? Math.ceil((this.target[1] - this.current[1]) / 10) : Math.floor((this.target[1] - this.current[1]) / 10);
            this.current = [this.origin[0] + deltX, this.origin[1] + deltY];
        }
    };

    var imageDir = "img/Jigsaw/",
        imageLength = 66,
        fragmentArray = [],
        imageTarget = [[129,0], [0,104], [130,464], [294,480], [373,478], [691,139], [494,43], [286,16], [253,81], [175,82], [74,116], [34,142], [45,238], [64,328], [35,350], [59,319], [140,435], [92,484], [270,450], [316,413], [398,466], [476,502], [472,405], [618,446], [674,414], [728,374], [743,314], [772,264], [752,229], [792,211], [762,184.5], [688,79], [630,59], [543,67], [516,101], [389,34], [466,107], [395,120], [268,78], [229,141], [131,133], [74,182], [154,319], [175,409], [199,319], [351,377], [375,352], [396,256], [465,317], [532,360], [589,335], [683,350], [649,158], [746,279], [705,141], [606,98], [235,231], [307,295], [520,279], [622,279], [625,220], [512,121], [329,256], [344,238], [375,183], [456,235]],
        temp = {};
    for(var i = 0; i < imageLength; i++) {
        temp = new Fragment();
        temp.target = [imageTarget[i][0] / 2 + stageCenter.x / 2, imageTarget[i][1] / 2 + stageCenter.y / 2];
        if (imageTarget[i][0] / 2 <= stageCenter.x / 2 && imageTarget[i][1] / 2 <= stageCenter.y / 2) {
            temp.origin = [-temp.target[0], -temp.target[1]];
        } else if (imageTarget[i][0] / 2 <= stageCenter.x / 2 && imageTarget[i][1] / 2 > stageCenter.y / 2) {
            temp.origin = [-temp.target[0], temp.target[1] * 2 - height];
        } else if (imageTarget[i][0] / 2 > stageCenter.x / 2 && imageTarget[i][1] / 2 <= stageCenter.y / 2) {
            temp.origin = [temp.target[0] * 2 - width, -temp.target[1]];
        } else {
            temp.origin = [temp.target[0] * 2 - width, temp.target[1] * 2 - height];
        }
        temp.src = imageDir + "m" + (i + 1) + ".png";
        temp.current = temp.origin;
        fragmentArray.push(temp);
        console.log(temp.origin);
    }



    function draw(image) {
        var img = new Image();
        img.onload = function(){
            ctx.drawImage(this, image.current[0], image.current[1], img.width / 2, img.height / 2);
        };
        img.src = image.src;
    }


    function frame(){
        ctx.clearRect(0, 0, width, height);
        fragmentArray.forEach(function(obj){
            obj.update();
            draw(obj);
        });
        K.requestAnimationFrame.call(window, frame);
    }
    frame();
})()

</script>
</body>
</html>